{"version":3,"file":"js/NotificationSettings-495e9311636324aa0315.js","mappings":"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","sources":["webpack://Plug-and-Play-Template/./src/modules/_data-layer/js/Services/UserService/UserService.js","webpack://Plug-and-Play-Template/./src/modules/_data-layer/js/libs/PromiseDebouncer.js","webpack://Plug-and-Play-Template/./src/modules/_data-layer/jsx/Contexts/UserContext/UserContext.jsx","webpack://Plug-and-Play-Template/./src/modules/_global/js/uuid.js","webpack://Plug-and-Play-Template/./src/modules/modal/jsx/modal.jsx","webpack://Plug-and-Play-Template/./src/modules/notifications-settings/jsx/notification-settings.jsx","webpack://Plug-and-Play-Template/./node_modules/prop-types/factoryWithThrowingShims.js","webpack://Plug-and-Play-Template/./node_modules/prop-types/index.js","webpack://Plug-and-Play-Template/./node_modules/prop-types/lib/ReactPropTypesSecret.js"],"sourcesContent":["/*!\n * @license\n * Copyright Squiz Australia Pty Ltd. All Rights Reserved.\n */\n\nimport { PromiseDebouncer } from '../../libs/PromiseDebouncer';\n\n/* eslint-disable import/prefer-default-export */\n\nexport class UserService {\n    constructor(dto) {\n        if (!dto) {\n            throw new Error(\n                `dto is required when instantiating a new UserService`\n            );\n        }\n\n        [`userAdapter`].forEach((name) => {\n            if (!dto[name]) {\n                throw new Error(\n                    `${name} property is required when instantiating a new UserService`\n                );\n            }\n        });\n\n        this.promiseDebouncer = new PromiseDebouncer();\n        this.userAdapter = dto.userAdapter;\n    }\n\n    /**\n     * Get user.\n     * @param {string} userId The user id.\n     *\n     * @returns {Promise<object>} A promised user.\n     */\n    get(userId) {\n        return this.promiseDebouncer.debounce(\n            {\n                method: `get`,\n                userId,\n            },\n            () => this.userAdapter.get(userId)\n        );\n    }\n\n    /**\n     * Update an user with new values.\n     *\n     * @param {string} documentId The user id.\n     * @param {object} user The user data to replace.\n     *\n     * @returns {Promise<object>} The result of the update.\n     */\n    setAll(user, documentId) {\n        return this.promiseDebouncer.debounce(\n            {\n                method: `get`,\n                documentId,\n            },\n            () => this.userAdapter.setAll(user, documentId)\n        );\n    }\n\n    /**\n     * Method will toggle given key in array.\n     *\n     * @param {string} notificationKey Notification key we need to toggle.\n     * @param {object} user User object.\n     *\n     * @return {Promise<object>} The result of the update.\n     */\n    updateNotifications(notificationKey, user) {\n        return this.promiseDebouncer.debounce(\n            {\n                method: `get`,\n                notificationKey,\n            },\n            () => this.userAdapter.updateNotifications(notificationKey, user)\n        );\n    }\n\n    /**\n     * Method will toggle push notifications on/off.\n     *\n     * @param {bool} toggle Flag determining if notifications should be on or off.\n     * @param {string} documentId For multiple promises only.\n     *\n     * @return {Promise<object>} The result of the update.\n     */\n    toggleNotifications(toggle, documentId) {\n        return this.promiseDebouncer.debounce(\n            {\n                method: `get`,\n                documentId,\n            },\n            () => this.userAdapter.toggleNotifications(toggle)\n        );\n    }\n}\n","/*!\n * @license\n * Copyright Squiz Australia Pty Ltd. All Rights Reserved.\n */\n\n// eslint-disable-next-line import/prefer-default-export\nexport class PromiseDebouncer {\n    constructor() {\n        this.requests = new Map();\n    }\n\n    debounce(key, promiseFactory) {\n        const keyForComparison = JSON.stringify(key);\n        if (!this.requests.has(keyForComparison)) {\n            const promise = promiseFactory();\n            // Clean up after the promise.\n            promise.finally(() => {\n                this.requests.delete(keyForComparison);\n            });\n            this.requests.set(keyForComparison, promise);\n        }\n        return this.requests.get(keyForComparison);\n    }\n\n    get(key) {\n        return this.requests.get(JSON.stringify(key));\n    }\n}\n","/*!\n * @license\n * Copyright Squiz Australia Pty Ltd. All Rights Reserved.\n */\n\nimport React, { createContext, useCallback, useEffect, useState } from 'react';\n\n/**\n * The user context provider.\n * @param {object} props The events provider props.\n * @returns {JSX.Element} Event context provider component.\n */\nexport const UserProvider = ({ children, userService, userId }) => {\n    const [isLoading, setIsLoading] = useState(false);\n    const [isReady, setIsReady] = useState(false);\n    const [user, setUser] = useState([]);\n\n    // Load user object from adapter and update internal state with fetched object.\n    useEffect(() => {\n        setIsLoading(true);\n\n        userService.get(userId).then((response) => {\n            setUser(response);\n            setIsLoading(false);\n            setIsReady(true);\n        });\n    }, [user]);\n\n    // Calls adapter method in order to update user with updated values.\n    const updateUser = useCallback(\n        (id, newUser) => {\n            setIsLoading(true);\n\n            return userService.setAll(newUser, id).then((result) => {\n                setUser(result);\n                setIsLoading(false);\n                setIsReady(true);\n            });\n        },\n        [user]\n    );\n\n    // Calls adapter method in order to update user push notifications preferences.\n    const toggleNotifications = useCallback(\n        (toggle) => {\n            setIsLoading(true);\n\n            return userService.toggleNotifications(toggle).then((result) => {\n                setUser(result);\n                setIsLoading(false);\n                setIsReady(true);\n            });\n        },\n        [user]\n    );\n\n    // Calls adapter method in order to update user notifications preferences.\n    const updateNotifications = useCallback(\n        (notifications) => {\n            setIsLoading(true);\n\n            return userService\n                .updateNotifications(notifications, user)\n                .then((result) => {\n                    setUser(result);\n                    setIsLoading(false);\n                    setIsReady(true);\n                });\n        },\n        [user]\n    );\n\n    return (\n        <UserContext.Provider\n            value={{\n                user,\n                userService,\n                isLoading,\n                isReady,\n                updateUser,\n                updateNotifications,\n                toggleNotifications,\n            }}\n        >\n            {children}\n        </UserContext.Provider>\n    );\n};\n\n/**\n * The context for user.\n * @export\n */\nexport const UserContext = createContext({\n    user: {},\n    userId: null,\n    userService: null,\n    isLoading: false,\n    isReady: false,\n    updateUser: () => {},\n    updateNotifications: () => {},\n    toggleNotifications: () => {},\n});\n","/* eslint-disable no-bitwise */\n/**\n * Generate a (mostly) unique ID in an RFC4122 version 4 compliant format\n * Function ported from initFormSubmissionHandler.\n *\n * @returns String\n *\n * @source https://stackoverflow.com/questions/105034/how-to-create-a-guid-uuid\n */\nexport default function uuidv4() {\n    return ([1e7] + -1e3 + -4e3 + -8e3 + -1e11).replace(/[018]/g, (c) =>\n        (\n            c ^\n            (crypto.getRandomValues(new Uint8Array(1))[0] & (15 >> (c / 4)))\n        ).toString(16)\n    );\n}\n","/* eslint-disable react/jsx-props-no-spreading */ // Disabled as prop spreading is the documented way to use the @react-aria framework\nimport React, { useEffect } from 'react';\nimport {\n    useOverlay,\n    usePreventScroll,\n    useModal,\n    OverlayContainer,\n} from '@react-aria/overlays';\nimport { useDialog } from '@react-aria/dialog';\nimport { FocusScope, useFocusManager } from '@react-aria/focus';\n\n/**\n * React implementation of the Plug and Play Modal, uses the Adobe @react-aria package\n * to handle the modal / dialog related accessability concerns such as focus movement, focus traps,\n * ESC to close ect.\n *\n * Needs to be wrapped within a <OverlayProvider> to aria hide the application when the modal opens.\n *\n * Comments on @react-aria hooks come directly from their documentation.\n */\nexport default function Modal({\n    titleId,\n    title,\n    onClose,\n    children,\n    className,\n}) {\n    return (\n        <OverlayContainer>\n            <div\n                className={`no-wysiwyg modal-wrapper ${\n                    className ? `${className}-wrapper` : ''\n                }`}\n            >\n                <FocusScope contain restoreFocus autoFocus>\n                    <ModalContent\n                        titleId={titleId}\n                        title={title}\n                        onClose={onClose}\n                        className={className}\n                    >\n                        {children}\n                    </ModalContent>\n                </FocusScope>\n            </div>\n        </OverlayContainer>\n    );\n}\n\nfunction ModalContent({ titleId, title, onClose, children, className }) {\n    // Base settings for @react-aria hooks\n    const settings = {\n        'aria-describedby': titleId,\n        title,\n        onClose,\n        isDismissable: true,\n        isOpen: true,\n    };\n\n    const modalRef = React.useRef();\n    const modalContentRef = React.useRef();\n    const focusManager = useFocusManager();\n\n    /*\n        Provides the behavior for overlays such as dialogs, popovers, and menus. Hides the overlay when\n        the user interacts outside it, when the Escape key is pressed, or optionally, on blur.\n    */\n    const { overlayProps, underlayProps } = useOverlay(\n        settings,\n        modalContentRef\n    );\n\n    /*\n        Prevents scrolling on the document body on mount, and restores it on unmount.\n        Also ensures that content does not shift due to the scrollbars disappearing.\n    */\n    usePreventScroll();\n\n    /*\n        Hides content outside the current <OverlayContainer> from screen readers on mount and restores it on unmount.\n    */\n    const { modalProps } = useModal();\n\n    /*\n        Provides the behavior and accessibility implementation for a dialog component.\n    */\n    const { dialogProps, titleProps } = useDialog(settings, modalContentRef);\n\n    /*\n        Remove the hidden attribute as soon as its drawn to the DOM so it transitions open like\n        the base ES6 modal in the framework.\n    */\n    useEffect(() => {\n        modalRef.current.removeAttribute('hidden');\n        focusManager.focusFirst(); // FocusScope autofocus property wont work due to being hidden so focus first now\n    }, [modalRef]);\n\n    return (\n        <div\n            ref={modalRef}\n            {...underlayProps}\n            hidden\n            className={`modal ${className || ''}`}\n        >\n            <div\n                ref={modalContentRef}\n                {...overlayProps}\n                {...dialogProps}\n                {...modalProps}\n                aria-modal=\"true\"\n                tabIndex=\"-1\"\n                className={`modal__content ${\n                    className ? `${className}__content` : ''\n                }`}\n            >\n                {titleId ? (\n                    ''\n                ) : (\n                    <h2\n                        {...titleProps}\n                        className={`${className ? `${className}__title` : ''}`}\n                    >\n                        {title}\n                    </h2>\n                )}\n                {children}\n            </div>\n        </div>\n    );\n}\n","/* eslint-disable react/jsx-props-no-spreading */\n/* eslint-disable no-prototype-builtins */\n/* eslint-disable jsx-a11y/label-has-associated-control */\nimport React, { useEffect, useState, useCallback, useContext } from 'react';\nimport { OverlayProvider } from '@react-aria/overlays';\nimport PropTypes from 'prop-types';\n\nimport uuidv4 from 'PlugAndPlay/_global/js/uuid';\nimport { UserService } from 'PlugAndPlay/_data-layer/js/global';\nimport { UserProvider, UserContext } from 'PlugAndPlay/_data-layer/jsx/global';\n\nimport Modal from '../../modal/jsx/modal';\n\nfunction NotificationsSettingsModal(props) {\n    const { title, pushNotificationsLabel, fieldsSpec } = props;\n\n    const {\n        user,\n        isReady,\n        isLoading,\n        updateUser,\n        updateNotifications,\n        toggleNotifications,\n    } = useContext(UserContext);\n\n    const [supportNotifications, setSupportNotification] = useState(false);\n    const [student, setStudent] = useState(null);\n    const [pushStatus, setPushStatus] = useState(false);\n    const [showModal, setShowModal] = useState(false);\n\n    const toggleModal = useCallback(() => {\n        setShowModal(!showModal);\n    }, [showModal]);\n\n    // This is to make sure our input fields have unique ids.\n    const fieldId = uuidv4();\n\n    // After fetching user object we are setting him in local state.\n    useEffect(() => {\n        setStudent(user);\n    }, [isReady]);\n\n    // Safari and iOS does not support notifications, we wont show panel.\n    useEffect(() => {\n        const agent = window.navigator.userAgent;\n        const iOS = !!agent.match(/iphone/i);\n        const safari = !!agent.match(/crios/i);\n        const supported = !(iOS || safari);\n\n        setSupportNotification(supported);\n    }, [isReady]);\n\n    // Call context and update user notification type preferences.\n    const toggleExcludedField = useCallback(\n        async (key) => {\n            await updateNotifications(key);\n            setStudent(user);\n        },\n        [user]\n    );\n\n    // Call context and update user push notifications preferences.\n    const togglePushNotifications = useCallback(\n        async (key) => {\n            setPushStatus(await toggleNotifications(key));\n        },\n        [user]\n    );\n\n    // Update user with new notification preferences.\n    const updateNotificationSettings = useCallback(async () => {\n        await updateUser(student);\n        setShowModal(false);\n    }, [student, pushStatus, supportNotifications]);\n\n    const titleId = uuidv4(); // Modal needs a id for the dialog described by\n\n    return (\n        <>\n            <button\n                type=\"button\"\n                className=\"notifications-settings__action\"\n                onClick={toggleModal}\n            >\n                Notification settings\n            </button>\n\n            {showModal && (\n                <Modal\n                    onClose={toggleModal}\n                    titleId={titleId}\n                    className=\"notifications-settings-modal\"\n                >\n                    <header className=\"notifications-settings-modal__header\">\n                        <h1\n                            id={titleId}\n                            className=\"notifications-settings-modal__title\"\n                        >\n                            {title}\n                        </h1>\n                        <button\n                            type=\"button\"\n                            onClick={toggleModal}\n                            className=\"notifications-settings-modal__header-close\"\n                        >\n                            <svg className=\"svg-icon\">\n                                <title>Close modal</title>\n                                <use href=\"#close\" />\n                            </svg>\n                        </button>\n                    </header>\n                    <div className=\"custom-form notifications-settings notifications-settings__container\">\n                        <div className=\"sq-form-question-answer\">\n                            <ul>\n                                {supportNotifications && (\n                                    <li className=\"notifications-settings__switch-item\">\n                                        <div className=\"notifications-settings__notifications-switch\">\n                                            <svg className=\"svg-icon notifications-settings__notifications-icon\">\n                                                <use href=\"#notification\" />\n                                            </svg>\n                                            <h2 className=\"notifications-settings__label\">\n                                                Push notifications\n                                            </h2>\n                                            <div className=\"switch\">\n                                                <input\n                                                    className=\"switch__input\"\n                                                    type=\"checkbox\"\n                                                    id={`switch-input-${fieldId}`}\n                                                    onChange={\n                                                        togglePushNotifications\n                                                    }\n                                                    value={pushStatus}\n                                                    disabled={!isReady}\n                                                    aria-describedby={`switch-status-${fieldId}`}\n                                                    aria-labelledby={`switch-description-${fieldId}`}\n                                                />\n                                                <label\n                                                    id={`switch-description-${fieldId}`}\n                                                    className=\"switch__label\"\n                                                    htmlFor={`switch-input-${fieldId}`}\n                                                >\n                                                    Toggle push notifications\n                                                </label>\n                                                <div\n                                                    className=\"switch__marker\"\n                                                    aria-hidden=\"true\"\n                                                />\n                                            </div>\n                                        </div>\n                                        <small\n                                            id={`switch-status-${fieldId}`}\n                                            className=\"notifications-settings__description\"\n                                        >\n                                            {' '}\n                                            {pushNotificationsLabel}\n                                        </small>\n                                    </li>\n                                )}\n                                {isReady &&\n                                    fieldsSpec.map(\n                                        ({ id, label, description, key }) => {\n                                            const labelId = uuidv4();\n                                            return (\n                                                <li\n                                                    key={id}\n                                                    className=\"notifications-settings__switch-item\"\n                                                >\n                                                    <input\n                                                        type=\"checkbox\"\n                                                        name={id}\n                                                        id={`${id}-${labelId}`}\n                                                        value={\n                                                            student.excludeNotificationTypes &&\n                                                            student.excludeNotificationTypes.includes(\n                                                                key\n                                                            )\n                                                        }\n                                                        disabled={!isReady}\n                                                        onChange={() =>\n                                                            toggleExcludedField(\n                                                                key\n                                                            )\n                                                        }\n                                                        className=\"sq-form-field\"\n                                                        aria-describedby={`${id}-${labelId}-description`}\n                                                        aria-labelledby={`${id}-${labelId}-label`}\n                                                    />\n                                                    <label\n                                                        id={`${id}-${labelId}-label`}\n                                                        htmlFor={`${id}-${labelId}`}\n                                                        className=\"notifications-settings__label\"\n                                                    >\n                                                        {label}\n                                                    </label>\n                                                    <small\n                                                        id={`${id}-${labelId}-description`}\n                                                        className=\"notifications-settings__description\"\n                                                    >\n                                                        {description}\n                                                    </small>\n                                                </li>\n                                            );\n                                        }\n                                    )}\n                            </ul>\n                        </div>\n                        <footer className=\"notifications-settings-modal__footer\">\n                            <button\n                                className=\"notifications-settings-modal__footer-button\"\n                                type=\"button\"\n                                onClick={updateNotificationSettings}\n                                disabled={isLoading}\n                            >\n                                Update notifications\n                                <span className=\"sr-only\">\n                                    {` `} Modal will be closed after pressing\n                                    update{' '}\n                                </span>\n                            </button>\n                        </footer>\n                    </div>\n                </Modal>\n            )}\n        </>\n    );\n}\n\nexport default function NotificationSettings(props) {\n    const { userAdapter, documentId } = props;\n\n    const userService = new UserService({ userAdapter });\n\n    return (\n        <OverlayProvider>\n            <UserProvider\n                userService={userService}\n                userId={documentId}\n                key={documentId}\n            >\n                <NotificationsSettingsModal {...props} />\n            </UserProvider>\n        </OverlayProvider>\n    );\n}\n\nconst { string, number, func, oneOfType, arrayOf, shape } = PropTypes;\n\nNotificationSettings.propTypes = {\n    title: string,\n    documentId: oneOfType([string, number]),\n    onDialogClose: func,\n    pushNotificationsLabel: string,\n    fieldsSpec: arrayOf(\n        shape({\n            id: string,\n            label: string,\n            description: string,\n            key: string,\n        })\n    ),\n};\n\nNotificationSettings.defaultProps = {\n    title: `Notifications settings`,\n    documentId: `666`,\n    onDialogClose: () => {},\n    pushNotificationsLabel: `Most students enable push notifications to stay on top of their studies. This will allow\n    you to receive notifications directly to this device.`,\n    fieldsSpec: [\n        {\n            id: `assignment_reminder`,\n            label: `Assignment reminder`,\n            description: `Remind me about assignments 1 day before their due date.`,\n            key: `assignment_reminder`,\n        },\n        {\n            id: `canvas_announcement`,\n            label: `Course announcements`,\n            description: `Announcements related to one of my courses.`,\n            key: `canvas_announcement`,\n        },\n    ],\n};\n","/**\n * Copyright (c) 2013-present, Facebook, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\n'use strict';\n\nvar ReactPropTypesSecret = require('./lib/ReactPropTypesSecret');\n\nfunction emptyFunction() {}\nfunction emptyFunctionWithReset() {}\nemptyFunctionWithReset.resetWarningCache = emptyFunction;\n\nmodule.exports = function() {\n  function shim(props, propName, componentName, location, propFullName, secret) {\n    if (secret === ReactPropTypesSecret) {\n      // It is still safe when called from React.\n      return;\n    }\n    var err = new Error(\n      'Calling PropTypes validators directly is not supported by the `prop-types` package. ' +\n      'Use PropTypes.checkPropTypes() to call them. ' +\n      'Read more at http://fb.me/use-check-prop-types'\n    );\n    err.name = 'Invariant Violation';\n    throw err;\n  };\n  shim.isRequired = shim;\n  function getShim() {\n    return shim;\n  };\n  // Important!\n  // Keep this list in sync with production version in `./factoryWithTypeCheckers.js`.\n  var ReactPropTypes = {\n    array: shim,\n    bigint: shim,\n    bool: shim,\n    func: shim,\n    number: shim,\n    object: shim,\n    string: shim,\n    symbol: shim,\n\n    any: shim,\n    arrayOf: getShim,\n    element: shim,\n    elementType: shim,\n    instanceOf: getShim,\n    node: shim,\n    objectOf: getShim,\n    oneOf: getShim,\n    oneOfType: getShim,\n    shape: getShim,\n    exact: getShim,\n\n    checkPropTypes: emptyFunctionWithReset,\n    resetWarningCache: emptyFunction\n  };\n\n  ReactPropTypes.PropTypes = ReactPropTypes;\n\n  return ReactPropTypes;\n};\n","/**\n * Copyright (c) 2013-present, Facebook, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nif (process.env.NODE_ENV !== 'production') {\n  var ReactIs = require('react-is');\n\n  // By explicitly using `prop-types` you are opting into new development behavior.\n  // http://fb.me/prop-types-in-prod\n  var throwOnDirectAccess = true;\n  module.exports = require('./factoryWithTypeCheckers')(ReactIs.isElement, throwOnDirectAccess);\n} else {\n  // By explicitly using `prop-types` you are opting into new production behavior.\n  // http://fb.me/prop-types-in-prod\n  module.exports = require('./factoryWithThrowingShims')();\n}\n","/**\n * Copyright (c) 2013-present, Facebook, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\n'use strict';\n\nvar ReactPropTypesSecret = 'SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED';\n\nmodule.exports = ReactPropTypesSecret;\n"],"names":["UserService","constructor","dto","Error","forEach","name","this","promiseDebouncer","PromiseDebouncer","userAdapter","get","userId","debounce","method","setAll","user","documentId","updateNotifications","notificationKey","toggleNotifications","toggle","requests","Map","key","promiseFactory","keyForComparison","JSON","stringify","has","promise","finally","delete","set","UserProvider","children","userService","isLoading","setIsLoading","useState","isReady","setIsReady","setUser","useEffect","then","response","updateUser","useCallback","id","newUser","result","notifications","UserContext","Provider","value","createContext","uuidv4","replace","c","crypto","getRandomValues","Uint8Array","toString","Modal","titleId","title","onClose","className","contain","restoreFocus","autoFocus","ModalContent","settings","isDismissable","isOpen","modalRef","React","modalContentRef","focusManager","useFocusManager","overlayProps","underlayProps","useOverlay","usePreventScroll","modalProps","useModal","dialogProps","titleProps","useDialog","current","removeAttribute","focusFirst","ref","hidden","tabIndex","NotificationsSettingsModal","props","pushNotificationsLabel","fieldsSpec","useContext","supportNotifications","setSupportNotification","student","setStudent","pushStatus","setPushStatus","showModal","setShowModal","toggleModal","fieldId","agent","window","navigator","userAgent","iOS","match","safari","toggleExcludedField","async","togglePushNotifications","updateNotificationSettings","type","onClick","href","onChange","disabled","htmlFor","map","label","description","labelId","excludeNotificationTypes","includes","NotificationSettings","string","number","func","oneOfType","arrayOf","shape","PropTypes","propTypes","onDialogClose","defaultProps","ReactPropTypesSecret","emptyFunction","emptyFunctionWithReset","resetWarningCache","module","exports","shim","propName","componentName","location","propFullName","secret","err","getShim","isRequired","ReactPropTypes","array","bigint","bool","object","symbol","any","element","elementType","instanceOf","node","objectOf","oneOf","exact","checkPropTypes"],"sourceRoot":""}